<!doctype html>
<!--

Welcome to the Indexbook Publishing Kit.
Create beautiful books using markdown.

1. Link to Indexbook Manual

want:
dirtslayer.github.io/Indexbook/The_Indexbook_Manual/
dirtslayer.github.io/Indexbook?f=The_Indexbook_Manual


2. There is a LICENSE file adjacent this file which applies to the Indexbook repository
   AND you should understand the LICENSE please

3. YOU should create issues, pull requests and forks please. PR's should include 
   addding your name to list of contributors, I would be thrilled if someone made a pr
   on this repo

-->
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width">
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <title>Indexbook</title>
  <link rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer" 
    href="https://unpkg.com/github-markdown-css/github-markdown-light.css" >
  
  <!-- @import url('https://fonts.googleapis.com/css2?family=Cedarville+Cursive&display=swap'); -->
  


<!--


  display: flex;
  align-items: center; /* Vertical alignment */
  justify-content: center; /* Horizontal alignment */
  height: 100vh; /* Full viewport height for demonstration */
  -->

  
  <style>



    
ul.flow-layout {
  display: flex;
  flex-wrap: wrap;
  flex-direction: row;
  list-style-type: none;
  margin: 0px 0px 30px 30px;
}

li.flow-layout {
  display: flex;
  align-items: left;
  justify-content: top;
  height: 300px;
  flex-direction: column;
  background-color: #f0f0f0;
  border: 0px solid #000;
  padding : 10 10 0 0;
}
    
.outerthumb {
  width: 200px;
  height: 300px;
  border: 2px solid #000;
}

.thumb {
  transform: scale(0.5);
  transform-origin: top left;
  width: 400px;
  height: 600px;
  background-color: ghostwhite; // ghostwhiter mention
}

img[src*="#200"] {  // hack to pass image width from md using bookmarks
  width:200px;
}

  </style>
</head>
<body ><a  id="indexmd"  href='index.md'  > index </a>
<a  id="prev"  href=''  > prev </a>
<a  id="next"  href=''  > next </a>
<a  id="raw"  href=''  > raw </a>
<div  class="markdown-body" ><h3><i>Indexbook</i></h3>
<ul id="Index" class="flow-layout"></ul></div>

  
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked-base-url"></script>
<script>


function preventDefaultLinks () {
  const myLinks = document.querySelectorAll("a");
  for (const link of myLinks) {
  link.onclick = (e) => {
    e.preventDefault();
    const linkData = e.target.getAttribute("href");
    getData(linkData);
  };
}
}

preventDefaultLinks();

      
async function getPage(f) {
  
}
  
async function getData(f) {
  if ( f === 'index.md' ) {
  const myRequest = new Request(`${f}`);
  fetch(myRequest)
    .then( async (response) => response.text())
    .then( async (text) =>  {
      const myArticle = document.querySelector("#Index");
      let links = "";
      let url = "";
      const arr = text.split(/\r?\n/);
      let thepage = "async hell";
      let my = null;
      
      arr.forEach( async (l) =>  {
        
        
        //thepage = await getPage(l);

      url = './' + l;
      my = new Request(url);
      fetch(my)
        .then((response) => response.text())
        .then((text) => {
          links += "<li class='flow-layout'><a href='./" + l + "'>" +  l.slice(0, -3).replaceAll("_"," ").split("/").pop();
          links += "</a><div class=\"outerthumb\"><div class=\"thumb\">";

          const base = "./" + l.split("/").slice(0,-1).join("/") + "/";
          marked.use(markedBaseUrl.baseUrl('/'));
          marked.use(markedBaseUrl.baseUrl(base));
          links += marked.parse(text);
          links += "</div></div></li>";
          
      }).then(()=>{
        myArticle.innerHTML = links;      
        preventDefaultLinks();  
      });
        
        
        
      });
      //
      
    });
  }
  else {
    const myRequest = new Request(`${f}`);
    fetch(myRequest)
      .then((response) => response.text())
      .then((text) => {
        const myArticle = document.querySelector("#Index");
        // we need to rewrite all urls because we are serving from parent folder 
        // (single page app inject)
        // so we grab the rel path for base from each link


        // ie a file inside Book folder that uses ./media/image.jpg
        // will be rewritten to ./Book/media/image.jpg
        marked.use(markedBaseUrl.baseUrl('/'));
        const base = "." + f.split("/").slice(0,-1).join("/") + "/";
        marked.use(markedBaseUrl.baseUrl(base));
        myArticle.innerHTML = marked.parse(text);
      });
  }
}

</script>
</body>
</html>
