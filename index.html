<!doctype html>
<!--

Welcome to the Indexbook Publishing Kit.
Create beautiful books using markdown.

1. Link to Indexbook Manual

want:
dirtslayer.github.io/Indexbook/The_Indexbook_Manual/
dirtslayer.github.io/Indexbook?f=The_Indexbook_Manual


2. There is a LICENSE file which applies to the entirety of the Indexbook repository.

3. YOU should create issues, pull requests and forks please. PR's should include 
   addding your name to list of contributers




-->
<html>
<head>
  <meta charset="utf-8"/>
  <title>Indexbook</title>
  <link rel="stylesheet" crossorigin="anonymous" referrerpolicy="no-referrer" 
    href="https://unpkg.com/github-markdown-css/github-markdown-light.css" >
  
  <!-- @import url('https://fonts.googleapis.com/css2?family=Cedarville+Cursive&display=swap'); -->
  

  <style>
    .outerthumb {
      width: 200px;
      height: 300px;
    }
    .thumb {
      transform: scale(0.5);
      // transform-origin: top left;
      width: 400px;
      height: 600px;
      background-color: ghostwhite;
      margin: 5em;
    }
    img[src*="#200"] {
      width:200px;
    }
  </style>
</head>
<body style="color: margin: 2em">
  
<a  id="indexmd"  href='index.md'  > index </a>
<a  id="prev"  href=''  > prev </a>
<a  id="next"  href=''  > next </a>
<a  id="raw"  href=''  > raw </a>
  
  
<div id="Index" class="markdown-body" ><h1><i>Welcome to Indexbook</i></h1></div>

  
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked-base-url"></script>
<script>


function preventDefaultLinks () {
  const myLinks = document.querySelectorAll("a");
  for (const link of myLinks) {
  link.onclick = (e) => {
    e.preventDefault();
    const linkData = e.target.getAttribute("href");
    getData(linkData);
  };
}
}

preventDefaultLinks();

      
async function getPage(f) {
  
}
  
async function getData(f) {
  if ( f === 'index.md' ) {
  const myRequest = new Request(`${f}`);
  fetch(myRequest)
    .then( async (response) => response.text())
    .then( async (text) =>  {
      const myArticle = document.querySelector("#Index");
      let links = "";
      let url = "";
      const arr = text.split(/\r?\n/);
      let thepage = "async hell";
      let my = null;
      
      arr.forEach( async (l) =>  {
        
        
        //thepage = await getPage(l);

      url = './' + l;
      my = new Request(url);
      fetch(my)
        .then((response) => response.text())
        .then((text) => {
          links += "<li><a href='./" + l + "'>" +  l.slice(0, -3).replaceAll("_"," ").split("/").pop();
          links += "</a><div class=\"outerthumb\"><div class=\"thumb\">";

          const base = "./" + l.split("/").slice(0,-1).join("/") + "/";
          marked.use(markedBaseUrl.baseUrl('/'));
          marked.use(markedBaseUrl.baseUrl(base));
          links += marked.parse(text);
          links += "</div> </div></li>\n";
          
      }).then(()=>{
        myArticle.innerHTML = links;      
        preventDefaultLinks();  
      });
        
        
        
      });
      //
      
    });
  }
  else {
    const myRequest = new Request(`${f}`);
    fetch(myRequest)
      .then((response) => response.text())
      .then((text) => {
        const myArticle = document.querySelector("#Index");
        // we need to rewrite all urls because we are serving from parent folder 
        // (single page app inject)
        // so we grab the rel path for base from each link


        // ie a file inside Book folder that uses ./media/image.jpg
        // will be rewritten to ./Book/media/image.jpg
        marked.use(markedBaseUrl.baseUrl('/'));
        const base = "." + f.split("/").slice(0,-1).join("/") + "/";
        marked.use(markedBaseUrl.baseUrl(base));
        myArticle.innerHTML = marked.parse(text);
      });
  }
}

</script>
</body>
</html>
